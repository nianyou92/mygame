<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸€æ„šæƒŠäºº - å¤§é©¬å®šåˆ¶ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        .active-team { transform: scale(1.1); border: 4px solid white; box-shadow: 0 0 20px rgba(255,255,255,0.5); z-index: 10; }
        .hidden-word { filter: blur(20px); pointer-events: none; }
        .peek-word { filter: blur(0px) !important; }
        @keyframes pulse-red { 0% { background-color: #1e293b; } 50% { background-color: #991b1b; } 100% { background-color: #1e293b; } }
        .emergency { animation: pulse-red 0.5s infinite; }
    </style>
</head>
<body class="bg-slate-900 flex flex-col items-center justify-center min-h-screen p-4 text-white font-sans overflow-hidden">

    <div id="setup-screen" class="fixed inset-0 bg-slate-900 z-50 flex flex-col items-center p-6 overflow-y-auto">
        <h1 class="text-3xl font-black mb-8 text-amber-400">æ¸¸æˆè®¾ç½®</h1>
        
        <div class="w-full max-w-md space-y-6">
            <div>
                <p class="mb-3 font-bold text-center">é€‰æ‹©æˆ˜é˜Ÿ (é€‰ä¸¤ç»„)</p>
                <div id="team-selector" class="grid grid-cols-2 gap-3">
                    <button onclick="toggleTeam(this, 'å®ˆé“¶é˜Ÿ', '#94a3b8')" class="p-3 rounded-xl border border-slate-700 bg-slate-800">å®ˆé“¶é˜Ÿ</button>
                    <button onclick="toggleTeam(this, 'å¨Ÿé‡‘é˜Ÿ', '#fbbf24')" class="p-3 rounded-xl border border-slate-700 bg-slate-800">å¨Ÿé‡‘é˜Ÿ</button>
                    <button onclick="toggleTeam(this, 'æç™½é˜Ÿ', '#ffffff')" class="p-3 rounded-xl border border-slate-700 bg-slate-800 text-slate-900">æç™½é˜Ÿ</button>
                    <button onclick="toggleTeam(this, 'ç»¸é»‘é˜Ÿ', '#000000')" class="p-3 rounded-xl border border-slate-700 bg-slate-800">ç»¸é»‘é˜Ÿ</button>
                    <button onclick="toggleTeam(this, 'ç»¿å¥‡é˜Ÿ', '#22c55e')" class="p-3 rounded-xl border border-slate-700 bg-slate-800">ç»¿å¥‡é˜Ÿ</button>
                    <button onclick="toggleTeam(this, 'å¯’è“é˜Ÿ', '#3b82f6')" class="p-3 rounded-xl border border-slate-700 bg-slate-800">å¯’è“é˜Ÿ</button>
                    <button onclick="toggleTeam(this, 'ç»é»„é˜Ÿ', '#eab308')" class="p-3 rounded-xl border border-slate-700 bg-slate-800 text-slate-900">ç»é»„é˜Ÿ</button>
                    <button onclick="toggleTeam(this, 'æ£•ç´«é˜Ÿ', '#a855f7')" class="p-3 rounded-xl border border-slate-700 bg-slate-800">æ£•ç´«é˜Ÿ</button>
                </div>
            </div>

            <div class="text-center">
                <p class="mb-2 font-bold">ç›®æ ‡åˆ†æ•°: <span id="target-display">10</span></p>
                <input type="range" min="5" max="15" value="10" id="target-slider" oninput="document.getElementById('target-display').innerText=this.value" class="w-full">
            </div>

            <button onclick="startGameSession()" class="w-full bg-amber-400 text-slate-900 font-black py-4 rounded-2xl text-xl shadow-lg">è¿›å…¥æ¸¸æˆ</button>
        </div>
    </div>

    <div class="w-full max-w-sm flex justify-between mb-8">
        <div id="ui-teamA" class="p-4 rounded-3xl text-center w-[45%] transition-all duration-300">
            <p id="labelA" class="text-xs font-bold opacity-70 uppercase tracking-widest">Team A</p>
            <p id="scoreA" class="text-4xl font-black">0</p>
            <p class="text-[10px] mt-1">Skip Left: <span id="skipsA">5</span></p>
        </div>
        <div id="ui-teamB" class="p-4 rounded-3xl text-center w-[45%] transition-all duration-300">
            <p id="labelB" class="text-xs font-bold opacity-70 uppercase tracking-widest">Team B</p>
            <p id="scoreB" class="text-4xl font-black">0</p>
            <p class="text-[10px] mt-1">Skip Left: <span id="skipsB">5</span></p>
        </div>
    </div>

    <div id="card-area" 
         onmousedown="peek(true)" onmouseup="peek(false)" 
         ontouchstart="peek(true)" ontouchend="peek(false)"
         class="w-full max-w-sm bg-white rounded-[2.5rem] shadow-2xl p-8 text-center relative overflow-hidden h-64 flex flex-col items-center justify-center">
        
        <div id="timer" class="absolute top-4 text-2xl font-mono text-slate-300 font-bold">60s</div>
        
        <div id="word-display" class="text-4xl font-black text-slate-800 hidden-word">ç‚¹å¼€å§‹æŠ½è¯</div>
        
        <div id="hint-text" class="absolute bottom-4 text-[10px] text-slate-400 uppercase tracking-tighter">é•¿æŒ‰ä¸­é—´å¯é‡çœ‹é¢˜ç›®</div>
    </div>

    <div class="w-full max-w-sm mt-8 space-y-3">
        <div id="pre-start-btns" class="grid grid-cols-2 gap-3">
            <button onclick="drawWord()" class="col-span-2 bg-amber-400 text-slate-900 font-black py-4 rounded-2xl shadow-lg">æŠ½è¯ / æ¢é¢˜</button>
            <button id="btn-start" onclick="startTimerNow()" disabled class="col-span-2 bg-slate-700 text-slate-400 font-bold py-4 rounded-2xl opacity-50">å¼€å§‹å€’è®¡æ—¶</button>
        </div>

        <div id="action-btns" class="grid grid-cols-2 gap-3 hidden">
            <button onclick="handlePoint()" class="bg-emerald-500 text-white font-black py-4 rounded-2xl shadow-lg">+1 å¾—åˆ†</button>
            <button onclick="handleSwitch()" class="bg-rose-500 text-white font-black py-4 rounded-2xl shadow-lg">è¢«æŠ¢é¢˜ / è½®æ›¿</button>
            <button onclick="handleSkip()" id="skip-btn" class="col-span-2 bg-slate-700 text-white font-bold py-2 rounded-xl text-sm">è·³è¿‡æœ¬é¢˜ (å‰© 5 æ¬¡)</button>
        </div>
    </div>

    <script>
        const speak = (msg) => {
            const utterance = new SpeechSynthesisUtterance(msg);
            utterance.lang = 'zh-CN';
            window.speechSynthesis.speak(utterance);
        };

        const playSound = (type) => {
            if(type === 'win') speak('å»å»çŒªï¼');
            if(type === 'fail') speak('å“ˆå“ˆå“ˆ Peter');
            if(type === 'end') speak('Delay no more');
        };

        // è¯åº“ - è¿™é‡Œå…ˆæ”¾200ä¸ªï¼Œä½ å¯ä»¥æŒ‰æ ¼å¼åŠ åˆ°1000ä¸ª
        const rawWords = "çƒ§ç±³,è‚‰éª¨èŒ¶,å·´åˆ¹,å•°æƒ¹,æ¤°æµ†é¥­,æ¦´è²,é¬¼ä½¬,é©¬è·¯æ€æ‰‹,æ‘‡è„š,æ‰“å·¥ä»”,è€å¸æœº,å¤§è€³çª¿,è·³æ§½,å±±ç«¹,æ‹‰èŒ¶,å’–å–±é¢,äº‘åé¢,ç‚¹å¿ƒ,ç‚’ç²¿æ¡,æµ·å—é¸¡é¥­,æ³¢éœ¸å¥¶èŒ¶,æ±Ÿé±¼ä»”,è‡­è±†,å¨˜æƒ¹,çº¢åŒ…,æ­å–œå‘è´¢,ä¸‡äº‹å¦‚æ„,å¿ƒæƒ³äº‹æˆ,èº«ä½“å¥åº·,å¹´å¹´æœ‰ä½™,æ­¥æ­¥é«˜å‡,å¤§å‰å¤§åˆ©,å¹³å¹³å®‰å®‰,å¼€å·¥å¤§å‰,æ”¶å·¥å¤§å‰,å…´æ—ºå‘,å¤§å½©,åšå½©,å¤šå¤š,ä¸‡èƒ½,æ‰«åœ°æœºå™¨äºº,æ™ºèƒ½æ‰‹æœº,å……ç”µå®,è‡ªæ‹æ†,æ— çº¿è€³æœº,è“ç‰™éŸ³ç®±,ç¬”è®°æœ¬ç”µè„‘,å¹³æ¿ç”µè„‘,è·¯ç”±å™¨,æŠ•å½±ä»ª,ç©ºæ°”å‡€åŒ–å™¨,å¸å°˜å™¨,å¾®æ³¢ç‚‰,ç”µé¥­ç…²,çƒ­æ°´å£¶,å¹é£æœº,å·å‘æ£’,å‰ƒé¡»åˆ€,ç”µåŠ¨ç‰™åˆ·,æŒ‰æ‘©æ¤…,è·‘æ­¥æœº,å“‘é“ƒ,ç‘œä¼½å«,è·³ç»³,è¶³çƒ,ç¯®çƒ,ç¾½æ¯›çƒ,ä¹’ä¹“çƒ,ç½‘çƒ,é«˜å°”å¤«çƒ,æ¸¸æ³³é•œ,æ½œæ°´é•œ,å†²æµªæ¿,æ»‘æ¿,æ»‘è½®é‹,å¤´ç›”,æŠ¤è†,æŠ¤è‚˜,æ‰‹å¥—,è¿åŠ¨é‹,è¿åŠ¨æœ,è¿åŠ¨æ°´å£¶,è¿åŠ¨åŒ…,èƒŒåŒ…,æåŒ…,é’±åŒ…,é’¥åŒ™åŒ…,åç‰‡å¤¹,æŠ¤ç…§å¤¹,è¡Œæç®±,é®é˜³ä¼,é›¨è¡£,å¢¨é•œ,å¸½å­,å›´å·¾,ä¸å·¾,é¢†å¸¦,çš®å¸¦,æ‰‹è¡¨,æˆ’æŒ‡,é¡¹é“¾,æ‰‹é“¾,è€³ç¯,å‘å¤¹,é¦™æ°´,å£çº¢,ç²‰åº•,çœ¼å½±,ç«æ¯›è†,æŒ‡ç”²æ²¹,æ´—é¢å¥¶,æ²æµ´éœ²,æ´—å‘æ°´,æŠ¤å‘ç´ ,ç‰™è†,æ¼±å£æ°´,çº¸å·¾,æ¹¿çº¸å·¾,å«ç”Ÿå·¾,å°¿ä¸æ¹¿,æ´—è¡£ç²‰,æ´—æ´ç²¾,æ¶ˆæ¯’æ¶²,æ´—æ‰‹æ¶²,åƒåœ¾è¢‹,ä¿é²œè†œ,é“ç®”çº¸,ç‰™ç­¾,æ£‰ç­¾,æŒ‡ç”²é’³,å°å‰ªåˆ€,æ°´æœåˆ€,å¼€ç“¶å™¨,èºä¸åˆ€,æ‰³æ‰‹,å·å°º,æ‰‹ç”µç­’,ç”µæ± ,æ‰“ç«æœº,èšŠé¦™,ç”µèšŠæ‹,è‹è‡æ‹,è€é¼ ç¬¼,èŸ‘è‚è¯,èš‚èšè¯,èƒ¶æ°´,é€æ˜èƒ¶,åŒé¢èƒ¶,è®¢ä¹¦æœº,å›å½¢é’ˆ,ä¾¿ç­¾æœ¬,ç¬”è®°æœ¬,åœ†ç ç¬”,é“…ç¬”,æ©¡çš®æ“¦,å°ºå­,åœ†è§„,è®¡ç®—å™¨,å‰ªè´´ç°¿,ç›¸æ¡†,æŒ‚é’Ÿ,é—¹é’Ÿ,èŠ±ç“¶,ç›†æ ½,é±¼ç¼¸,é¸Ÿç¬¼,å® ç‰©å«,ç‰µå¼•ç»³,çŒ«ç ‚,ç‹—ç²®,é±¼é£Ÿ,é¸Ÿé£Ÿ,æ‰«æŠŠ,æ‹–æŠŠ,æ°´æ¡¶,æŠ¹å¸ƒ,å›´è£™,éš”çƒ­æ‰‹å¥—,é¤å·¾å¸ƒ,æ¡Œå¸ƒ,æ¯å«,ç­·å­,å‹ºå­,å‰å­,ç¢—,ç›˜,æ¯,æ°´ç“¶,é¥­ç›’,ä¿æ¸©æ¯,ç„–çƒ§æ¯,è°ƒæ–™ç›’,æ²¹å£¶,ç›ç½,ç³–ç½,é†‹ç“¶,é…±æ²¹ç“¶,å’–å•¡å£¶,èŒ¶å£¶,æ»¤èŒ¶å™¨,æ‰“è›‹å™¨,é¢ç²‰ç­›,æ“€é¢æ–,æ¨¡å…·,çƒ¤ç›˜,çƒ¤ç½‘,é”¡çº¸,æ²¹çº¸";
        const gameWords = rawWords.split(',');

        let selectedTeams = [];
        let teamA = { name: '', color: '', score: 0, skips: 5 };
        let teamB = { name: '', color: '', score: 0, skips: 5 };
        let targetScore = 10;
        let currentTurn = 'A'; // 'A' or 'B'
        let timer, timeLeft = 60;
        let gameActive = false;

        function toggleTeam(btn, name, color) {
            const index = selectedTeams.findIndex(t => t.name === name);
            if(index > -1) {
                selectedTeams.splice(index, 1);
                btn.style.border = "1px solid #334155";
            } else if(selectedTeams.length < 2) {
                selectedTeams.push({name, color});
                btn.style.border = `4px solid ${color}`;
            }
        }

        function startGameSession() {
            if(selectedTeams.length < 2) return alert("è¯·é€‰ä¸¤æ”¯æˆ˜é˜Ÿï¼");
            targetScore = document.getElementById('target-slider').value;
            teamA = { ...selectedTeams[0], score: 0, skips: 5 };
            teamB = { ...selectedTeams[1], score: 0, skips: 5 };
            
            document.getElementById('labelA').innerText = teamA.name;
            document.getElementById('labelB').innerText = teamB.name;
            document.getElementById('ui-teamA').style.backgroundColor = teamA.color + '33';
            document.getElementById('ui-teamB').style.backgroundColor = teamB.color + '33';
            
            updateTurnUI();
            document.getElementById('setup-screen').classList.add('hidden');
        }

        function updateTurnUI() {
            const uiA = document.getElementById('ui-teamA');
            const uiB = document.getElementById('ui-teamB');
            if(currentTurn === 'A') {
                uiA.classList.add('active-team');
                uiB.classList.remove('active-team');
                uiA.style.borderColor = teamA.color;
            } else {
                uiB.classList.add('active-team');
                uiA.classList.remove('active-team');
                uiB.style.borderColor = teamB.color;
            }
        }

        function drawWord() {
            const word = gameWords[Math.floor(Math.random() * gameWords.length)];
            const display = document.getElementById('word-display');
            display.innerText = word;
            display.classList.remove('hidden-word');
            document.getElementById('btn-start').disabled = false;
            document.getElementById('btn-start').classList.remove('opacity-50');
            document.getElementById('btn-start').classList.add('bg-blue-500', 'text-white');
        }

        function startTimerNow() {
            document.getElementById('pre-start-btns').classList.add('hidden');
            document.getElementById('action-btns').classList.remove('hidden');
            document.getElementById('word-display').classList.add('hidden-word');
            document.getElementById('category').innerText = "å€’è®¡æ—¶å¼€å§‹ï¼";
            
            timeLeft = 60;
            gameActive = true;
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = timeLeft + 's';
                
                if(timeLeft <= 5) {
                    document.body.classList.add('emergency');
                    // è­¦å‘Šå£°å¯ä»¥ç”¨ç®€å•çš„Beep
                }
                
                if(timeLeft <= 0) {
                    clearInterval(timer);
                    playSound('end');
                    handleSwitch();
                }
            }, 1000);
        }

        function peek(show) {
            if(!gameActive) return;
            const display = document.getElementById('word-display');
            if(show) display.classList.add('peek-word');
            else display.classList.remove('peek-word');
        }

        function handlePoint() {
            clearInterval(timer);
            gameActive = false;
            document.body.classList.remove('emergency');
            
            if(currentTurn === 'A') {
                teamA.score++;
                document.getElementById('scoreA').innerText = teamA.score;
            } else {
                teamB.score++;
                document.getElementById('scoreB').innerText = teamB.score;
            }
            
            playSound('win');
            checkWin();
            resetControls();
        }

        function handleSwitch() {
            clearInterval(timer);
            gameActive = false;
            document.body.classList.remove('emergency');
            playSound('fail');
            currentTurn = currentTurn === 'A' ? 'B' : 'A';
            updateTurnUI();
            resetControls();
        }

        function handleSkip() {
            let activeTeam = currentTurn === 'A' ? teamA : teamB;
            if(activeTeam.skips <= 0) return alert("æ²¡è·³è¿‡æ¬¡æ•°äº†ï¼");
            activeTeam.skips--;
            document.getElementById(`skips${currentTurn}`).innerText = activeTeam.skips;
            drawWord();
            document.getElementById('word-display').classList.add('hidden-word');
        }

        function resetControls() {
            document.getElementById('pre-start-btns').classList.remove('hidden');
            document.getElementById('action-btns').classList.add('hidden');
            document.getElementById('word-display').innerText = "ç‚¹å¼€å§‹æŠ½è¯";
            document.getElementById('word-display').classList.add('hidden-word');
            document.getElementById('btn-start').disabled = true;
            document.getElementById('timer').innerText = "60s";
        }

        function checkWin() {
            if(teamA.score >= targetScore || teamB.score >= targetScore) {
                const winner = teamA.score >= targetScore ? teamA.name : teamB.name;
                confetti({
                    particleCount: 200,
                    spread: 70,
                    origin: { y: 0.6 }
                });
                alert("ğŸ‰ " + winner + " èµ¢äº†ï¼");
                location.reload();
            }
        }
    </script>
</body>
</html>
