<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>一愚惊人 - 大马终极版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        .active-team { transform: scale(1.1); border: 6px solid white; box-shadow: 0 0 30px rgba(255,255,255,0.6); z-index: 10; }
        .hidden-word { color: transparent !important; text-shadow: 0 0 50px rgba(0,0,0,1); user-select: none; }
        .peek-word { color: #1e293b !important; text-shadow: none !important; }
        @keyframes pulse-red { 0% { background-color: #0f172a; } 50% { background-color: #7f1d1d; } 100% { background-color: #0f172a; } }
        .emergency { animation: pulse-red 0.5s infinite; }
        /* 防止手机长按弹出菜单 */
        * { -webkit-touch-callout: none; -webkit-user-select: none; }
    </style>
</head>
<body class="bg-slate-950 flex flex-col items-center justify-center min-h-screen p-4 text-white font-sans overflow-hidden">

    <div id="setup-screen" class="fixed inset-0 bg-slate-900 z-50 flex flex-col items-center p-6 overflow-y-auto">
        <h1 class="text-4xl font-black mb-8 text-amber-400 italic">一愚惊人 SETTING</h1>
        
        <div class="w-full max-w-md space-y-8">
            <div class="grid grid-cols-2 gap-4" id="team-selector">
                </div>

            <div class="text-center bg-slate-800 p-6 rounded-3xl">
                <p class="mb-4 font-bold text-xl text-amber-200">胜利分数: <span id="target-display">10</span></p>
                <input type="range" min="5" max="15" value="10" id="target-slider" 
                       oninput="document.getElementById('target-display').innerText=this.value" 
                       class="w-full h-3 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-400">
            </div>

            <button onclick="startGameSession()" class="w-full bg-gradient-to-r from-amber-400 to-orange-500 text-slate-900 font-black py-5 rounded-2xl text-2xl shadow-[0_0_20px_rgba(251,191,36,0.4)]">开始派对</button>
        </div>
    </div>

    <div class="w-full max-w-sm flex justify-between mb-6">
        <div id="ui-teamA" class="p-4 rounded-3xl text-center w-[46%] transition-all duration-500 border-4 border-transparent">
            <p id="labelA" class="text-sm font-black truncate">TEAM A</p>
            <p id="scoreA" class="text-5xl font-black my-1">0</p>
        </div>
        <div id="ui-teamB" class="p-4 rounded-3xl text-center w-[46%] transition-all duration-500 border-4 border-transparent">
            <p id="labelB" class="text-sm font-black truncate">TEAM B</p>
            <p id="scoreB" class="text-5xl font-black my-1">0</p>
        </div>
    </div>

    <div id="card-area" 
         class="w-full max-w-sm bg-slate-100 rounded-[3rem] shadow-2xl p-10 text-center relative h-72 flex flex-col items-center justify-center transition-transform active:scale-95">
        <div id="timer" class="absolute top-6 text-3xl font-mono text-slate-400 font-black">60s</div>
        <div id="word-display" class="text-5xl font-black text-slate-800 transition-all duration-200">准备就绪</div>
        <div id="hint-text" class="absolute bottom-6 text-xs text-slate-400 font-bold opacity-0 transition-opacity">长按屏幕显示提示</div>
    </div>

    <div class="w-full max-w-sm mt-8 space-y-4">
        <div id="pre-game-controls" class="space-y-3">
            <button id="btn-draw" onclick="drawWord()" class="w-full bg-white text-slate-900 font-black py-5 rounded-2xl text-xl shadow-lg border-b-8 border-slate-300 active:border-b-0 active:translate-y-2">抽题</button>
            <button id="btn-change" onclick="changeWord()" class="w-full bg-slate-800 text-amber-400 font-bold py-3 rounded-xl border-2 border-slate-700 opacity-50 cursor-not-allowed">换题 (剩 5 次)</button>
            <button id="btn-confirm" onclick="confirmAndStart()" class="w-full bg-amber-400 text-slate-900 font-black py-5 rounded-2xl text-xl shadow-lg hidden">确认并开始计时</button>
        </div>

        <div id="active-game-controls" class="grid grid-cols-2 gap-4 hidden">
            <button onclick="handlePoint()" class="bg-emerald-500 text-white font-black py-5 rounded-2xl shadow-lg text-xl">+1 答对</button>
            <button onclick="handleSwitch()" class="bg-rose-500 text-white font-black py-4 rounded-2xl shadow-lg font-bold">被抢/轮替</button>
        </div>
    </div>

    <script>
        const teams = [
            { name: '守银队', bg: '#94a3b8', text: '#000000' },
            { name: '娟金队', bg: '#fbbf24', text: '#000000' },
            { name: '极白队', bg: '#ffffff', text: '#000000' },
            { name: '绸黑队', bg: '#000000', text: '#ffffff' },
            { name: '绿奇队', bg: '#22c55e', text: '#000000' },
            { name: '寒蓝队', bg: '#3b82f6', text: '#ffffff' },
            { name: '绍黄队', bg: '#eab308', text: '#000000' },
            { name: '棕紫队', bg: '#a855f7', text: '#ffffff' }
        ];

        let
